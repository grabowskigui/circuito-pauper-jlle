<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CPJ | Circuito Pauper Joinville</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --cpj-blue: #0a2240; --cpj-red: #e31d1a; }
        body { background-color: #ffffff; font-family: 'Inter', sans-serif; color: #1a1a1a; scroll-behavior: smooth; }
        .text-cpj-blue { color: var(--cpj-blue); }
        .bg-cpj-blue { background-color: var(--cpj-blue); }
        .border-cpj-red { border-color: var(--cpj-red); }
        /* Esconde barra de rolagem mas permite scroll horizontal se necess√°rio */
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body>

    <nav class="bg-white/90 backdrop-blur-md border-b border-gray-100 py-4 px-6 md:py-6 md:px-12 flex justify-between items-center sticky top-0 z-50">
        
        <button onclick="toggleMenu()" class="md:hidden p-2 text-[#0a2240] hover:bg-gray-100 rounded-lg transition-colors">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
        </button>

        <div class="hidden md:flex gap-12 font-bold text-[11px] uppercase tracking-[0.2em] text-gray-400 absolute left-1/2 transform -translate-x-1/2">
            <a href="#ranking" class="hover:text-[#0a2240] transition-colors">Ranking</a>
            <a href="#proximos-eventos" class="hover:text-[#0a2240] transition-colors">Calend√°rio</a>
            <a href="#campeoes" class="hover:text-[#0a2240] transition-colors">Hall da Fama</a>
        </div>

        <a href="https://chat.whatsapp.com/GtbH7LexnG53Oot2pWfOOl" target="_blank" class="bg-[#25D366] text-white px-4 py-2 md:px-8 md:py-3 rounded-full font-black text-[9px] md:text-[10px] tracking-widest shadow-lg hover:scale-105 transition-all flex items-center gap-2">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.941 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.462-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.151-.172.2-.296.3-.495.099-.198.05-.372-.025-.521-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.095 3.2 5.076 4.487.709.306 1.263.489 1.694.626.712.226 1.36.194 1.872.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.29.173-1.414z"/></svg>
            <span class="md:inline">WHATSAPP</span>
        </a>
    </nav>

   <div id="mobile-menu-overlay" class="fixed inset-0 bg-[#0a2240] z-[60] hidden flex-col items-center justify-center gap-8 opacity-0 transition-opacity duration-300">
        <div class="absolute top-[-10%] right-[-10%] w-64 h-64 bg-red-600 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-pulse"></div>
        <div class="absolute bottom-[-10%] left-[-10%] w-64 h-64 bg-blue-500 rounded-full mix-blend-multiply filter blur-3xl opacity-20"></div>

        <button onclick="toggleMenu()" class="absolute top-6 right-6 p-2 text-white/50 hover:text-white hover:bg-white/10 rounded-full transition-all z-10">
            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
        </button>

        <div class="w-32 mb-4 drop-shadow-2xl z-10">
            <img src="img/logo-cpj.png" alt="Logo CPJ" class="w-full opacity-90">
        </div>

        <div class="flex flex-col items-center gap-6 w-full z-10">
            <a href="#ranking" onclick="toggleMenu()" class="group relative px-8 py-3 text-xl font-bold text-white uppercase tracking-[0.2em] transition-all">
                <span class="relative z-10 group-hover:text-red-400 transition-colors">Ranking</span>
                <span class="absolute inset-0 bg-white/5 scale-0 group-hover:scale-100 rounded-xl transition-transform duration-300"></span>
            </a>
            <a href="#proximos-eventos" onclick="toggleMenu()" class="group relative px-8 py-3 text-xl font-bold text-white uppercase tracking-[0.2em] transition-all">
                <span class="relative z-10 group-hover:text-red-400 transition-colors">Calend√°rio</span>
                <span class="absolute inset-0 bg-white/5 scale-0 group-hover:scale-100 rounded-xl transition-transform duration-300"></span>
            </a>
            <a href="#campeoes" onclick="toggleMenu()" class="group relative px-8 py-3 text-xl font-bold text-white uppercase tracking-[0.2em] transition-all">
                <span class="relative z-10 group-hover:text-red-400 transition-colors">Hall da Fama</span>
                <span class="absolute inset-0 bg-white/5 scale-0 group-hover:scale-100 rounded-xl transition-transform duration-300"></span>
            </a>
            <a href="#gameplays" onclick="toggleMenu()" class="group relative px-8 py-3 text-xl font-bold text-white uppercase tracking-[0.2em] transition-all">
                <span class="relative z-10 group-hover:text-red-400 transition-colors">Gameplays</span>
                <span class="absolute inset-0 bg-white/5 scale-0 group-hover:scale-100 rounded-xl transition-transform duration-300"></span>
            </a>
        </div>
    </div>

    <header id="home" class="pt-8 pb-16 px-6 text-center max-w-7xl mx-auto">
        <div class="mb-4">
            <img src="img/logo-cpj.png" alt="Logo CPJ" class="w-64 md:w-[380px] mx-auto drop-shadow-2xl animate-in zoom-in duration-700">
        </div>
        <div class="overflow-visible pb-2"> 
            <h1 class="text-5xl md:text-8xl font-black text-[#0a2240] tracking-tighter uppercase italic leading-[0.9] flex flex-col items-center">
                <span class="block">CIRCUITO PAUPER</span>
                <span class="text-transparent bg-clip-text bg-gradient-to-r from-red-600 to-red-800 pr-4 py-1">JOINVILLE</span>
            </h1>
        </div>
        <p class="text-gray-400 text-lg md:text-xl font-medium max-w-2xl mx-auto leading-relaxed mt-4">
            Onde os comuns se tornam lendas. Temporada 2026.
        </p>
    </header>

    <section id="ranking" class="py-20 bg-gray-50 px-6">
        <div class="max-w-4xl mx-auto text-center">
            <h2 class="text-4xl font-black uppercase italic tracking-tighter text-cpj-blue mb-4">Ranking Geral</h2>
            
            <div class="flex justify-center items-center gap-4 mb-8">
                <button onclick="navegarEtapa(-1)" id="btn-voltar-etapa" class="p-3 bg-white border-2 border-gray-100 rounded-full text-gray-400 hover:border-cpj-red hover:text-cpj-red transition-all disabled:opacity-30 disabled:cursor-not-allowed shadow-sm">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M15 19l-7-7 7-7"></path></svg>
                </button>
                <div class="relative group">
                    <select id="filtro-etapa" class="appearance-none bg-white border-2 border-gray-100 text-[#0a2240] font-black uppercase tracking-widest text-xs py-3 pl-8 pr-12 rounded-full cursor-pointer hover:border-cpj-red transition-colors focus:outline-none focus:border-cpj-red shadow-sm w-48 text-center">
                        <option value="">Carregando...</option>
                    </select>
                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-cpj-red group-hover:translate-x-1 transition-transform">
                        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M19 9l-7 7-7-7"></path></svg>
                    </div>
                </div>
                <button onclick="navegarEtapa(1)" id="btn-avancar-etapa" class="p-3 bg-white border-2 border-gray-100 rounded-full text-gray-400 hover:border-cpj-red hover:text-cpj-red transition-all disabled:opacity-30 disabled:cursor-not-allowed shadow-sm">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M9 5l7 7-7 7"></path></svg>
                </button>
            </div>

            <div class="bg-white rounded-3xl shadow-xl overflow-hidden border border-gray-100 min-h-[500px]">
               <table class="w-full text-sm table-fixed">
                <thead>
                    <tr class="text-left text-[10px] uppercase tracking-widest text-gray-400 border-b">
                        <th class="w-[15%] py-3 text-center">Pos</th>
                        <th class="w-[60%] py-3 pl-2">Jogador</th>
                        <th class="w-[25%] py-3 text-right pr-4">Pontos</th>
                    </tr>
                </thead>
                <tbody id="tabela-ranking-body" class="divide-y divide-gray-50"></tbody>
                </table>
            </div>
            
            <div class="mt-10 flex justify-center items-center gap-6">
                <button onclick="mudarPagina(-1)" id="btn-prev" class="p-3 rounded-full border border-gray-200 text-gray-400 hover:border-cpj-red hover:text-cpj-red disabled:opacity-30 disabled:cursor-not-allowed transition-all">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M15 19l-7-7 7-7"></path></svg>
                </button>
                <div class="flex flex-col">
                    <span id="info-pagina" class="text-[10px] font-black uppercase tracking-widest text-cpj-blue">P√°gina 1</span>
                    <span id="info-posicao" class="text-[9px] text-gray-400 font-bold uppercase tracking-tight">Mostrando 1-8</span>
                </div>
                <button onclick="mudarPagina(1)" id="btn-next" class="p-3 rounded-full border border-gray-200 text-gray-400 hover:border-cpj-red hover:text-cpj-red disabled:opacity-30 disabled:cursor-not-allowed transition-all">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M9 5l7 7-7 7"></path></svg>
                </button>
            </div>
        </div>
    </section>

    <section class="py-20 bg-white px-6 border-t border-gray-100">
        <div class="max-w-4xl mx-auto">
            <div class="flex flex-col md:flex-row justify-between items-end mb-12 gap-6">
                <div>
                    <h2 class="text-4xl font-black text-[#0a2240] uppercase italic tracking-tighter">Meta Game</h2>
                    <p class="text-gray-400 font-bold uppercase text-[10px] tracking-[0.3em] mt-2">O que est√° dominando o field</p>
                </div>
                <div class="text-right">
                    <span class="text-xs font-bold text-gray-500 uppercase tracking-widest">Baseado nos √∫ltimos torneios</span>
                </div>
            </div>
            <div id="meta-game-container" class="grid gap-6 transition-all duration-500">
                <p class="text-center text-gray-400 text-xs animate-pulse">Carregando estat√≠sticas...</p>
            </div>
            <div id="meta-btn-container" class="text-center mt-10 hidden">
                <button onclick="toggleMetaGame()" id="btn-meta-expandir" class="inline-flex items-center gap-2 border-2 border-gray-100 text-gray-400 font-black text-xs px-8 py-4 rounded-full hover:border-cpj-red hover:text-cpj-red transition-all uppercase tracking-widest">
                    <span>Ver Meta Completo</span>
                    <svg id="seta-meta" class="w-4 h-4 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M19 9l-7 7-7-7"></path></svg>
                </button>
            </div>
        </div>
    </section>

    <section id="proximos-eventos" class="py-24 px-6 bg-white">
        <div class="max-w-4xl mx-auto">
            <div class="text-center mb-16">
                <h2 class="text-4xl font-black text-cpj-blue uppercase italic tracking-tighter">üóìÔ∏è Calend√°rio de Etapas</h2>
                <p class="text-gray-400 font-bold uppercase text-[10px] tracking-[0.3em] mt-2">Temporada 2026</p>
            </div>
            <div id="calendario-container" class="grid gap-3"></div>
            <div class="text-center mt-10">
                <button id="btn-expandir" onclick="toggleCalendario()" class="inline-flex items-center gap-2 border-2 border-gray-100 text-gray-400 font-black text-xs px-8 py-4 rounded-full hover:border-cpj-red hover:text-cpj-red transition-all uppercase tracking-widest">
                    <span>Ver Calend√°rio Completo</span>
                    <svg id="seta-expandir" class="w-4 h-4 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M19 9l-7 7-7-7"></path></svg>
                </button>
            </div>
        </div>
    </section>

    <section id="campeoes" class="py-24 px-6 max-w-[1400px] mx-auto border-t border-gray-100 relative">
        <h2 class="text-4xl font-black text-cpj-blue mb-16 uppercase italic tracking-tighter text-center">üèÜ Hall da Fama</h2>
        
        <div id="hall-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-8 w-full transition-all duration-500">
            </div>

        <div id="hall-btn-container" class="text-center mt-12 hidden">
            <button onclick="toggleHall()" class="inline-flex items-center gap-2 border-2 border-gray-100 text-gray-400 font-black text-xs px-8 py-4 rounded-full hover:border-cpj-red hover:text-cpj-red transition-all uppercase tracking-widest">
                <span id="btn-hall-text">Mostrar Mais</span>
                <svg id="btn-hall-icon" class="w-4 h-4 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M19 9l-7 7-7-7"></path></svg>
            </button>
        </div>

    </section>

    <footer class="bg-[#0a2240] text-white py-10 px-6 border-t border-white/5">
        <div class="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-16 md:gap-8">
            <div class="flex flex-col items-center md:items-start text-center md:text-left">
                <img src="img/logo-cpj.png" alt="Logo CPJ" class="h-40 w-auto mb-16 grayscale brightness-200 opacity-75">
                <p class="text-gray-400 text-sm leading-relaxed max-w-xs uppercase font-bold tracking-tighter">
                    Circuito Pauper Joinville.<br>
                    Onde os comuns se tornam lendas. Temporada 2026.
                </p>
            </div>
            <div class="flex flex-col items-center text-center">
                <h4 class="text-xs font-black uppercase tracking-[0.3em] mb-8 text-red-600">Comunidade</h4>
                <div class="flex flex-col gap-4">
                    <a href="https://chat.whatsapp.com/GtbH7LexnG53Oot2pWfOOl" target="_blank" class="text-sm font-bold hover:text-red-600 transition-colors uppercase tracking-widest">WhatsApp</a>
                    <a href="https://www.instagram.com/jpcpauper/" class="text-sm font-bold hover:text-red-600 transition-colors uppercase tracking-widest">Instagram</a>
                    <a href="#" class="text-sm font-bold hover:text-red-600 transition-colors uppercase tracking-widest">Youtube</a>
                </div>
            </div>
            <div class="flex flex-col items-center md:items-end text-center md:text-right">
                <h4 class="text-xs font-black uppercase tracking-[0.3em] mb-8 text-red-600">Apoio</h4>
                <a href="https://www.magigames.com.br/" target="_blank" class="text-sm font-bold text-gray-400 uppercase tracking-widest mb-2">Magi Games</a>
                <p class="text-[10px] text-gray-500 uppercase tracking-widest">Joinville, SC</p>
                <div class="mt-8">
                </div>
            </div>
        </div>
        <div class="max-w-7xl mx-auto mt-20 pt-8 border-t border-white/5 flex flex-col md:flex-row justify-between items-center gap-4">
            <p class="text-[9px] font-bold text-gray-600 uppercase tracking-[0.3em]">¬© 2026 Circuito Pauper Joinville</p>
            <p class="text-[9px] font-bold text-gray-600 uppercase tracking-[0.3em]">Desenvolvido para a Comunidade</p>
        </div>
    </footer>

    <script>
        // --- CONFIGURA√á√ïES ---
        const SHEET_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSs3dG3a3b_rjQlUwFZL3G48wOoTv5OSnnRtNsan7sk56QWe4Lf02uQ8X-ltOoD2kOczcmv6K_387gs/pub?output=csv';
        const META_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQ1-fHtMSqio6beIEqEiTB9LwyyqMyJ2OV1MbvNipdXPPEJlvsIF45EEhv6mNhF5caAAN73aWSZ-Pua/pub?gid=1925365919&single=true&output=csv';

        // --- VARI√ÅVEIS GLOBAIS ---
        let jogadoresRaw = []; 
        let totalEtapasReais = 0;   
        let rankingExibido = []; 
        let paginaAtual = 1;
        const jogadoresPorPagina = 8;
        
        // Elementos DOM Ranking
        const selectEtapa = document.getElementById('filtro-etapa');
        const btnVoltarEtapa = document.getElementById('btn-voltar-etapa');
        const btnAvancarEtapa = document.getElementById('btn-avancar-etapa');

        // --- 1. RANKING (CARREGAMENTO E L√ìGICA BLINDADA) ---
        async function carregarRanking() {
            try {
                const urlComBypass = `${SHEET_CSV_URL}&t=${Date.now()}`;
                const response = await fetch(urlComBypass);
                const data = await response.text();
                const linhas = data.split('\n').filter(l => l.trim() !== "");
                
                jogadoresRaw = linhas.slice(1).map(linha => {
                    const colunas = linha.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                    const nome = colunas[0]?.replace(/"/g, '').trim() || "Desconhecido";
                    const pontosHistorico = colunas.slice(1).map(p => {
                        let valorLimpo = p?.replace(/"/g, '').trim(); 
                        if (valorLimpo === '-' || valorLimpo === '') return null;
                        const numero = parseInt(valorLimpo);
                        return isNaN(numero) ? null : numero;
                    });
                    return { nome, pontos: pontosHistorico };
                });

                if (jogadoresRaw.length > 0) {
                    const maxColunas = jogadoresRaw[0].pontos.length;
                    for (let i = 0; i < maxColunas; i++) {
                        if (jogadoresRaw.some(p => p.pontos[i] !== null)) {
                            totalEtapasReais = i + 1;
                        }
                    }
                    if (totalEtapasReais === 0) totalEtapasReais = 1;
                    popularDropdownEtapas(totalEtapasReais);
                    calcularERenderizar(totalEtapasReais);
                }
            } catch (error) {
                console.error("Erro fatal:", error);
                document.getElementById('tabela-ranking-body').innerHTML = '<tr><td colspan="3" class="p-10 text-red-500 text-center">Erro ao carregar dados.</td></tr>';
            }
        }

        function popularDropdownEtapas(qtd) {
            selectEtapa.innerHTML = "";
            for (let i = 1; i <= qtd; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.innerText = `ETAPA ${i}`;
                selectEtapa.appendChild(option);
            }
            selectEtapa.value = qtd;
            atualizarBotoesNavegacao();
        }

        function navegarEtapa(direcao) {
            const atual = parseInt(selectEtapa.value);
            const nova = atual + direcao;
            if (nova >= 1 && nova <= totalEtapasReais) {
                selectEtapa.value = nova;
                calcularERenderizar(nova);
            }
        }

        function atualizarBotoesNavegacao() {
            const atual = parseInt(selectEtapa.value);
            btnVoltarEtapa.disabled = atual <= 1;
            btnAvancarEtapa.disabled = atual >= totalEtapasReais;
        }

        function calcularERenderizar(etapaSelecionada) {
            etapaSelecionada = parseInt(etapaSelecionada);
            atualizarBotoesNavegacao();

            const rankingAtual = gerarRankingNaData(etapaSelecionada);
            let rankingAnterior = [];
            let mapaAnterior = {}; 

            if (etapaSelecionada > 1) {
                rankingAnterior = gerarRankingNaData(etapaSelecionada - 1);
                rankingAnterior.forEach((jog, idx) => {
                    mapaAnterior[jog.nome] = idx + 1;
                });
            }

            rankingExibido = rankingAtual.map((jog, idx) => {
                const posAtual = idx + 1;
                const posAntiga = mapaAnterior[jog.nome];
                let variacao = 0; 
                if (etapaSelecionada === 1 || !posAntiga) {
                    variacao = "NEW";
                } else {
                    variacao = posAntiga - posAtual;
                }
                return { ...jog, variacao, posReal: posAtual };
            });

            paginaAtual = 1;
            renderTabelaHTML();
        }

        function gerarRankingNaData(etapaLimite) {
            const lista = [];
            jogadoresRaw.forEach(j => {
                const sliceHistorico = j.pontos.slice(0, etapaLimite);
                if (sliceHistorico.some(p => p !== null)) {
                    const total = sliceHistorico.reduce((acc, curr) => acc + (curr || 0), 0);
                    lista.push({ nome: j.nome, total: total });
                }
            });
            lista.sort((a, b) => b.total - a.total);
            return lista;
        }

        function renderTabelaHTML() {
            const tbody = document.getElementById('tabela-ranking-body');
            const inicio = (paginaAtual - 1) * jogadoresPorPagina;
            const fim = inicio + jogadoresPorPagina;
            const listaParaExibir = rankingExibido.slice(inicio, fim);

            if (listaParaExibir.length === 0) {
                 tbody.innerHTML = '<tr><td colspan="3" class="p-10 text-center text-gray-400 text-xs uppercase tracking-widest">Calculando...</td></tr>';
                 return;
            }

            tbody.innerHTML = listaParaExibir.map(jogador => {
                let corPos = 'text-gray-400';
                if (jogador.posReal === 1) corPos = 'text-yellow-500';
                if (jogador.posReal === 2) corPos = 'text-gray-400 font-bold';
                if (jogador.posReal === 3) corPos = 'text-amber-600';

                let htmlVariacao = '<span class="text-gray-300 text-[10px]">=</span>'; 
                if (jogador.variacao === 'NEW') {
                      htmlVariacao = '<span class="text-blue-500 text-[9px] font-black tracking-tighter uppercase bg-blue-50 px-1 rounded border border-blue-100">NEW</span>';
                } else if (jogador.variacao > 0) {
                     htmlVariacao = `<div class="flex items-center gap-1 text-green-500 bg-green-50 px-1.5 py-0.5 rounded border border-green-100"><svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 10l7-7m0 0l7 7m-7-7v18"></path></svg><span class="text-[10px] font-black">${jogador.variacao}</span></div>`;
                } else if (jogador.variacao < 0) {
                     htmlVariacao = `<div class="flex items-center gap-1 text-red-500 bg-red-50 px-1.5 py-0.5 rounded border border-red-100"><svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path></svg><span class="text-[10px] font-black">${Math.abs(jogador.variacao)}</span></div>`;
                }

                return `
                    <tr class="hover:bg-gray-50 transition border-b border-gray-50 last:border-0 h-16">
                        <td class="font-black text-lg md:text-xl ${corPos} italic text-center align-middle">
                            <div class="flex flex-col items-center justify-center gap-1"><span>${jogador.posReal}¬∫</span>${htmlVariacao}</div>
                        </td>
                        <td class="font-bold text-gray-800 uppercase tracking-tight text-left align-middle text-xs md:text-sm pl-2"><div class="truncate w-full pr-2">${jogador.nome}</div></td>
                        <td class="text-right font-black text-[#0a2240] italic align-middle text-sm md:text-lg pr-4">${jogador.total} <span class="text-[8px] md:text-[10px] text-gray-400 font-normal not-italic">PTS</span></td>
                    </tr>
                `;
            }).join(''); 

            document.getElementById('info-pagina').innerText = `P√°gina ${paginaAtual}`;
            if(rankingExibido.length > 0) {
                 document.getElementById('info-posicao').innerText = `Mostrando ${inicio + 1}-${Math.min(fim, rankingExibido.length)}`;
            }
            document.getElementById('btn-prev').disabled = paginaAtual === 1;
            document.getElementById('btn-next').disabled = fim >= rankingExibido.length;
        }

        selectEtapa.addEventListener('change', (e) => calcularERenderizar(e.target.value));
        function mudarPagina(direcao) {
            paginaAtual += direcao;
            renderTabelaHTML();
            document.getElementById('ranking').scrollIntoView({ behavior: 'smooth' });
        }

        // --- 2. CALEND√ÅRIO AUTOM√ÅTICO ---
        const dadosEtapas = [
            { n: '01', data: '06/01/2026', valor: 'R$ 20,00', local: 'Magi Games' },
            { n: '02', data: '13/01/2026', valor: 'R$ 20,00', local: 'Magi Games' },
            { n: '03', data: '20/01/2026', valor: 'R$ 20,00', local: 'Magi Games' },
            { n: '04', data: '27/01/2026', valor: 'R$ 20,00', local: 'Magi Games' },
            { n: '05', data: '03/02/2026', valor: 'R$ 20,00', local: 'Magi Games' },
            { n: '06', data: '10/02/2026', valor: 'R$ 20,00', local: 'Magi Games' },
            { n: '07', data: '17/02/2026', valor: 'R$ 20,00', local: 'Magi Games' },
            { n: '08', data: '24/02/2026', valor: 'R$ 20,00', local: 'Magi Games' },
            { n: '09', data: '03/03/2026', valor: 'R$ 20,00', local: 'Magi Games' },
            { n: '10', data: '10/03/2026', valor: 'R$ 20,00', local: 'Magi Games' }
        ];
        let calExpandido = false;

        function renderCalendario() {
            const container = document.getElementById('calendario-container');
            const listaParaExibir = calExpandido ? dadosEtapas : dadosEtapas.slice(0, 5); 
            const hoje = new Date();
            hoje.setHours(0,0,0,0);
            let proximaEncontrada = false;

            container.innerHTML = listaParaExibir.map(e => {
                const partes = e.data.split('/');
                const dataEtapa = new Date(partes[2], partes[1] - 1, partes[0]);
                let status = 'future';
                if (dataEtapa < hoje) status = 'done';
                else if (dataEtapa >= hoje && !proximaEncontrada) {
                    status = 'next';
                    proximaEncontrada = true;
                }
                let visualClasses = 'border-gray-100 hover:border-cpj-red';
                let badge = '';
                if (status === 'done') {
                    visualClasses = 'border-green-100 bg-gray-50 opacity-60'; 
                    badge = '<span class="bg-green-100 text-green-700 border border-green-200 px-2 py-1 rounded text-[9px] font-black uppercase tracking-widest">Conclu√≠do</span>';
                } else if (status === 'next') {
                    visualClasses = 'border-red-600 shadow-lg ring-1 ring-red-100 bg-white transform scale-[1.02]';
                    badge = '<span class="bg-red-600 text-white px-3 py-1 rounded text-[9px] font-black uppercase tracking-widest animate-pulse shadow-md">Pr√≥xima Etapa</span>';
                }
                return `
                <div class="flex flex-col md:flex-row md:items-center justify-between p-5 rounded-2xl border transition-all group ${visualClasses}">
                    <div class="mb-3 md:mb-0 flex flex-col gap-2">
                        <div class="flex items-center gap-3">
                            <span class="text-[9px] font-black ${status === 'next' ? 'text-red-600' : 'text-gray-400'} uppercase tracking-widest">Etapa ${e.n}</span>
                            ${badge}
                        </div>
                        <h3 class="text-md font-black text-[#0a2240] uppercase italic">Circuito Pauper Joinville</h3>
                    </div>
                    <div class="grid grid-cols-3 md:flex gap-6 text-[11px] font-bold uppercase text-gray-600">
                        <div class="flex flex-col"><span class="text-gray-400 text-[9px] mb-1 font-normal">Data</span>${e.data}</div>
                        <div class="flex flex-col"><span class="text-gray-400 text-[9px] mb-1 font-normal">Valor</span>${e.valor}</div>
                        <div class="flex flex-col"><span class="text-gray-400 text-[9px] mb-1 font-normal">Local</span>${e.local}</div>
                    </div>
                </div>
            `}).join('');
        }
        function toggleCalendario() {
            calExpandido = !calExpandido;
            renderCalendario();
            const btn = document.getElementById('btn-expandir');
            const seta = document.getElementById('seta-expandir');
            btn.querySelector('span').innerText = calExpandido ? 'Mostrar Menos' : 'Ver Calend√°rio Completo';
            seta.style.transform = calExpandido ? 'rotate(180deg)' : 'rotate(0deg)';
        }

        // --- 3. HALL DA FAMA (CORRIGIDO E COM BOT√ÉO "MOSTRAR MAIS") ---
        const hallDaFamaData = [
            { etapa: 1, nome: "Gustavo Schwarz", deck: "UB Crab Control", img: "img/ETAPA01.JPG", link: "https://moxfield.com/decks/w9Uy3gzcSkKHqNWUzrCY0w", status: 'done' },
            { etapa: 2, nome: "Eron Moggio", deck: "BW Blade", img: "img/ETAPA02.JPG", link: "https://moxfield.com/decks/21u9iqGsAke7C-Y1ae2zog", status: 'done' },
            { etapa: 3, nome: "Eron Moggio", deck: "BW Blade", img: "img/ETAPA03.JPG", link: "https://moxfield.com/decks/21u9iqGsAke7C-Y1ae2zog", status: 'done' },
            { etapa: 4, nome: "Guilherme Watzko", deck: "Mono U Faeries", img: "img/etapa04.jpg.jpg", link: "https://moxfield.com/decks/9jV1Fkom20iPtPOreU1_9Q", status: 'done' },
            { etapa: 5, nome: "A Definir", data: "03 FEV", img: "", link: "#", status: 'pending' },
            { etapa: 6, nome: "A Definir", data: "10 FEV", img: "", link: "#", status: 'pending' },
            { etapa: 7, nome: "A Definir", data: "17 FEV", img: "", link: "#", status: 'pending' },
            { etapa: 8, nome: "A Definir", data: "24 FEV", img: "", link: "#", status: 'pending' },
            { etapa: 9, nome: "A Definir", data: "03 MAR", img: "", link: "#", status: 'pending' },
            { etapa: 10, nome: "A Definir", data: "10 MAR", img: "", link: "#", status: 'pending' }
        ];

        let mostrarTodosHall = false; // Estado para controlar se mostra tudo ou s√≥ 5

function renderHall() {
            const container = document.getElementById('hall-container');
            const btnContainer = document.getElementById('hall-btn-container');
            const btnText = document.getElementById('btn-hall-text');
            const btnIcon = document.getElementById('btn-hall-icon');

            // Decide se mostra todos ou apenas os 5 primeiros
            const listaParaExibir = mostrarTodosHall ? hallDaFamaData : hallDaFamaData.slice(0, 5);

            container.innerHTML = listaParaExibir.map(item => {
                if (item.status === 'done') {
                    // --- CARD CAMPE√ÉO (REDESENHADO) ---
                    return `
                    <div class="group relative mt-12 h-full">
                        <div class="bg-white rounded-2xl shadow-md p-6 pt-16 text-center border-t-4 border-red-600 hover:shadow-2xl hover:-translate-y-1 transition-all duration-300 h-full flex flex-col justify-between relative">
                            
                            <div class="absolute -top-10 left-1/2 transform -translate-x-1/2 w-24 h-24 rounded-full border-[6px] border-white shadow-lg overflow-hidden z-10 bg-gray-100">
                                <img src="${item.img}" alt="Campe√£o" class="w-full h-full object-cover object-top transition-transform duration-500 group-hover:scale-110">
                            </div>

                            <div class="mt-2">
                                <span class="inline-block bg-gray-100 text-gray-500 text-[9px] font-black tracking-[0.2em] uppercase px-2 py-1 rounded-full mb-3">
                                    Etapa #${item.etapa.toString().padStart(2, '0')}
                                </span>
                                <h3 class="text-xl font-black text-[#0a2240] mb-1 leading-tight italic">${item.nome}</h3>
                                <p class="text-red-600 font-bold text-xs uppercase tracking-widest mb-6 opacity-80">${item.deck}</p>
                            </div>

                            <a href="${item.link}" target="_blank" class="group/btn relative inline-flex items-center justify-center gap-2 w-full py-3 bg-[#0a2240] text-white rounded-xl font-black text-[10px] tracking-widest overflow-hidden hover:bg-red-700 transition-colors shadow-md uppercase">
                                <span class="relative z-10 flex items-center gap-2">
                                    Ver Decklist
                                    <svg class="w-3 h-3 transition-transform group-hover/btn:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
                                </span>
                            </a>
                        </div>
                    </div>`;
                } else {
                    // --- CARD BLOQUEADO (MANTIDO O ESTILO LIMPO) ---
                    return `
                    <div class="relative mt-12 h-full opacity-60 hover:opacity-100 transition-opacity duration-300">
                        <div class="bg-gray-50 rounded-2xl border-2 border-dashed border-gray-200 p-6 pt-16 text-center h-full flex flex-col justify-between relative">
                            
                            <div class="absolute -top-10 left-1/2 transform -translate-x-1/2 w-24 h-24 rounded-full border-[6px] border-white shadow-sm bg-gray-100 flex items-center justify-center z-10 text-gray-300">
                                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg>
                            </div>

                            <div class="mt-2">
                                <span class="inline-block bg-gray-100 text-gray-300 text-[9px] font-black tracking-[0.2em] uppercase px-2 py-1 rounded-full mb-3">
                                    Etapa #${item.etapa.toString().padStart(2, '0')}
                                </span>
                                <h3 class="text-xl font-black text-gray-300 mb-1 leading-tight italic uppercase">Em Breve</h3>
                                <p class="text-gray-300 font-bold text-xs uppercase tracking-widest mb-6 opacity-60">${item.data || '---'}</p>
                            </div>

                            <div class="w-full py-3 bg-gray-200 text-gray-400 rounded-xl font-bold text-[10px] tracking-widest uppercase cursor-default flex items-center justify-center gap-2">
                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg>
                                Bloqueado
                            </div>
                        </div>
                    </div>`;
                }
            }).join('');

            // Controle do bot√£o Mostrar Mais
            if (hallDaFamaData.length > 5) {
                btnContainer.classList.remove('hidden');
                btnText.innerText = mostrarTodosHall ? 'Mostrar Menos' : 'Mostrar Mais';
                btnIcon.style.transform = mostrarTodosHall ? 'rotate(180deg)' : 'rotate(0deg)';
            } else {
                btnContainer.classList.add('hidden');
            }
        }

        // Fun√ß√£o chamada ao clicar no bot√£o "Mostrar Mais"
        function toggleHall() {
            mostrarTodosHall = !mostrarTodosHall;
            renderHall();
        }

        // --- 4. META GAME ---
        let metaDadosCache = [];
        let metaExpandido = false;
        async function carregarMetaGame() {
            try {
                const response = await fetch(META_CSV_URL);
                const data = await response.text();
                const linhas = data.split('\n').filter(l => l.trim() !== "");
                let totalDecks = 0;
                metaDadosCache = linhas.map(linha => {
                    const colunas = linha.split(',');
                    const nome = colunas[0]?.trim();
                    const qtd = parseInt(colunas[1]?.trim() || "0");
                    if(nome && qtd) {
                        totalDecks += qtd;
                        return { nome, qtd };
                    }
                    return null;
                }).filter(i => i !== null);
                metaDadosCache.forEach(d => d.totalGeral = totalDecks);
                renderMetaVisual();
            } catch (error) {
                console.error("Erro meta:", error);
                document.getElementById('meta-game-container').innerHTML = '<p class="text-center text-red-500 text-xs">Erro.</p>';
            }
        }
        function renderMetaVisual() {
            const container = document.getElementById('meta-game-container');
            const btnContainer = document.getElementById('meta-btn-container');
            const listaParaExibir = metaExpandido ? metaDadosCache : metaDadosCache.slice(0, 4);
            container.innerHTML = '';
            listaParaExibir.forEach(deck => {
                const porcentagem = ((deck.qtd / deck.totalGeral) * 100).toFixed(1); 
                container.innerHTML += `<div class="group animate-in fade-in slide-in-from-bottom-4 duration-700"><div class="flex justify-between text-sm font-bold text-[#0a2240] uppercase tracking-wider mb-2"><span>${deck.nome}</span><span>${porcentagem}% <span class="text-[9px] text-gray-400 font-normal">(${deck.qtd})</span></span></div><div class="w-full bg-gray-100 rounded-full h-3 overflow-hidden"><div class="bg-red-600 h-3 rounded-full group-hover:bg-[#0a2240] transition-all duration-1000" style="width: ${porcentagem}%"></div></div></div>`;
            });
            if (metaDadosCache.length > 4) {
                btnContainer.classList.remove('hidden');
                const btn = document.getElementById('btn-meta-expandir');
                const seta = document.getElementById('seta-meta');
                btn.querySelector('span').innerText = metaExpandido ? 'Mostrar Menos' : 'Ver Meta Completo';
                seta.style.transform = metaExpandido ? 'rotate(180deg)' : 'rotate(0deg)';
            }
        }
        function toggleMetaGame() {
            metaExpandido = !metaExpandido;
            renderMetaVisual(); 
        }

        // --- INICIALIZA√á√ÉO ---
        carregarRanking();
        renderCalendario();
        carregarMetaGame();
        renderHall(); // Inicia o Hall da Fama

        function toggleMenu() {
            const menu = document.getElementById('mobile-menu-overlay');
            if (menu.classList.contains('hidden')) {
                menu.classList.remove('hidden');
                setTimeout(() => { menu.classList.remove('opacity-0'); menu.classList.add('opacity-100'); }, 10);
            } else {
                menu.classList.remove('opacity-100'); menu.classList.add('opacity-0');
                setTimeout(() => { menu.classList.add('hidden'); }, 300);
            }
        }
    </script>
</body>
</html>